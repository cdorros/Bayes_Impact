{% extends "base.html" %}

{% block head_extra %}
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

<script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer.js"></script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript" src="data.js"></script>
<script type="text/javascript" src="data.json"></script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-sm-12">

        <h1 class="whoa">There are <strong class="text-info">{{numMines}}</strong> mines in the United States</h1>
        <div id="map"></div>

        <h1 class="whoa">In 2013,  <strong class="text-warning"># violations</strong> were issued by goverment inspectors . . .  </h1>
        <h1 class="whoa">. . . and  <strong class="text-danger"># people died</strong> in mining-related accidents. </h1>

        
        <h1 class="whoa">We are using <strong class="text-primary">data</strong> to predict at-risk mines . . . </h1>
        <h1 class="whoa">. . . so that we can <strong class="text-success">better target safety inspections</strong> and <strong class="text-success">save lives</strong>.</h1>

            <div class="center">
                <a class="btn btn-primary btn-large strong" href="/model/"><h1>View the Analysis</h1></a>
            </div>
    </div>
</div>
<script>
    var mapstyle = [{"featureType":"water","stylers":[{"color":"#021019"}]},{"featureType":"landscape","stylers":[{"color":"#08304b"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#0c4152"},{"lightness":5}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#0b434f"},{"lightness":25}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#000000"}]},{"featureType":"road.arterial","elementType":"geometry.stroke","stylers":[{"color":"#0b3d51"},{"lightness":16}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"}]},{"elementType":"labels.text.fill","stylers":[{"color":"#ffffff"}]},{"elementType":"labels.text.stroke","stylers":[{"color":"#000000"},{"lightness":13}]},{"featureType":"transit","stylers":[{"color":"#146474"}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#000000"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#144b53"},{"lightness":14},{"weight":1.4}]}];

    var locations = {{ coords|tojson }};

    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: new google.maps.LatLng(41.850033, -87.6500523),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        styles: mapstyle
    });
    var infowindow = new google.maps.InfoWindow();
    var marker, i;

    var markers = [];

    for (i = 0; i < locations.length; i++) {
        marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
        });

        google.maps.event.addListener(marker, 'click', (function (marker, i) {
            return function () {
                content = '<a href="/mines/' + locations[i][0] + '">' + locations[i][3] + '</a>'
                infowindow.setContent(content);
                infowindow.open(map, marker);
            }
        })(marker, i));

        markers.push(marker);
    }

    var markerCluster = new MarkerClusterer(map, markers);


</script>
{% endblock %}
